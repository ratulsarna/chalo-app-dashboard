{
  "flowId": "onboarding",
  "flowName": "Onboarding",
  "description": "Complete analytics map for the user onboarding journey, including splash screen, language selection, city selection (both old and new flows), and city discontinued handling.",
  "propertyDefinitions": {
    "source": {
      "type": "string",
      "description": "Screen or context where the event occurred. Typically the exact value of `Source.<X>.sourceName` (e.g., Source.SPLASH_SCREEN.sourceName, Source.LANGUAGE_SELECTION.sourceName, Source.CITY_SELECTION_SCREEN.sourceName)."
    },
    "previousScreen": {
      "type": "string",
      "description": "Navigation origin point - the `Source.<X>.sourceName` value of the screen that triggered navigation to the current screen. Emitted via AnalyticsEventConstants.ATTRIBUTE_PREVIOUS_SCREEN."
    },
    "locale": {
      "type": "string",
      "description": "Selected language locale code (e.g., 'en' for English, 'hi' for Hindi).",
      "values": [
        "en",
        "hi",
        "kn",
        "mr",
        "ta",
        "te",
        "bn",
        "gu"
      ]
    },
    "language": {
      "type": "string",
      "description": "Language locale code when language is changed.",
      "values": [
        "en",
        "hi",
        "kn",
        "mr",
        "ta",
        "te",
        "bn",
        "gu"
      ]
    },
    "city": {
      "type": "string",
      "description": "City identifier emitted by the app. In the new city-location-selection flow this is typically the selected cityId."
    },
    "cityName": {
      "type": "string",
      "description": "City display name emitted by the app. Used in the old city selection flow and the city discontinued flow."
    },
    "desc": {
      "type": "string",
      "description": "Description text associated with city selection."
    },
    "selectedby": {
      "type": "string",
      "description": "Indicates how the city was selected.",
      "values": [
        "user",
        "location",
        "auto"
      ]
    },
    "element": {
      "type": "string",
      "description": "Element identifier for permission popup.",
      "values": [
        "tutorial_location"
      ]
    },
    "reason": {
      "type": "string",
      "description": "Error reason when city fetch from location fails.",
      "values": [
        "CityIdNotAvailable",
        "CityNotServiceable",
        "CityMetaDataFetchError(msg=...)"
      ]
    },
    "locationAccessAction": {
      "type": "string",
      "description": "User action captured by `access location event` when the system permission prompt is responded to.",
      "values": [
        "preciseLocationOptionSelected",
        "approxLocationOptionSelected",
        "locationPermissionDeniedByUser"
      ]
    },
    "isChaloConfigMigrated": {
      "type": "boolean",
      "description": "Whether Chalo Config has been migrated. Sent on `app open`."
    },
    "src": {
      "type": "string",
      "description": "App-open sub-source string for internal bucketing. Sent on `app open`.",
      "values": [
        "onboarding"
      ]
    },
    "deviceId": {
      "type": "string",
      "description": "Unique device identifier set as user property."
    },
    "isNotifPermGranted": {
      "type": "string",
      "description": "Whether notification permission is granted - stored as a string user property.",
      "values": [
        "true",
        "false"
      ]
    },
    "migrationRequired": {
      "type": "string",
      "description": "Whether app migration is required - stored as a string user property.",
      "values": [
        "true",
        "false"
      ]
    },
    "firstSeen": {
      "type": "string",
      "description": "Installation date/time - set as user property on first app open."
    },
    "is fine location enabled": {
      "type": "boolean",
      "description": "Whether fine (precise) location permission is granted. Sent on Location Disclaimer events."
    },
    "is coarse location enabled": {
      "type": "boolean",
      "description": "Whether coarse (approximate) location permission is granted. Sent on Location Disclaimer events."
    },
    "is gps enabled": {
      "type": "boolean",
      "description": "Whether GPS is enabled. Sent on Location Disclaimer events."
    },
    "result denied": {
      "type": "number",
      "description": "Location settings resolution denied status code (from SettingsResolutionException.statusCode)."
    }
  },
  "stages": [
    {
      "name": "Splash Screen",
      "description": "Initial app launch and initialization events.",
      "events": [
        "first screen open",
        "app open",
        "new home screen rendered",
        "tab based homescreen rendered"
      ]
    },
    {
      "name": "Language Selection",
      "description": "Language selection during onboarding.",
      "events": [
        "language selection screen displayed",
        "language screen continue clicked",
        "language changed"
      ]
    },
    {
      "name": "City Selection (Old Flow)",
      "description": "Legacy city selection flow events.",
      "events": [
        "city selection screen displayed",
        "city selection search icon clicked",
        "city selected",
        "permission_popup"
      ]
    },
    {
      "name": "City Location Selection (New Flow)",
      "description": "Modern city selection flow with device location and manual entry options.",
      "events": [
        "city location selection screen opened",
        "enable device location clicked",
        "access location event",
        "enter location manually clicked",
        "retry city fetch clicked",
        "change location clicked",
        "explore chalo cities clicked",
        "user refused location permission",
        "user refused location permission via settings",
        "user refused to turn gps on",
        "city selected",
        "city not serviceable screen",
        "city fetch from location failed"
      ]
    },
    {
      "name": "City Discontinued",
      "description": "Handling of discontinued cities.",
      "events": [
        "city discontinued screen displayed",
        "city discontinued change city clicked"
      ]
    },
    {
      "name": "User Properties",
      "description": "User properties set during onboarding (not events, but tracked attributes).",
      "events": []
    },
    {
      "name": "Location Disclaimer",
      "description": "Auto-added stage (validate grouping).",
      "events": [
        "access location event",
        "go to settings btn clicked",
        "location denied event",
        "location disclaimer activity opened",
        "location permission result event",
        "location successfully enabled"
      ]
    }
  ],
  "events": [
    {
      "name": "app open",
      "component": "FireAppOpenEventIfRequiredUseCase (called from SplashScreenComponent)",
      "stage": "Splash Screen",
      "source": "Source.SPLASH_SCREEN.sourceName",
      "description": "Raised during splash initialization to mark an app-open. Note: analyticsContract.incrementAppOpen() increments a usage counter, but does not emit the 'app open' event.",
      "properties": [
        {
          "property": "source",
          "context": "Source.SPLASH_SCREEN.sourceName"
        },
        {
          "property": "isChaloConfigMigrated",
          "context": "Hardcoded boolean (currently true)"
        },
        {
          "property": "src",
          "context": "'onboarding' (hardcoded)"
        }
      ]
    },
    {
      "name": "change location clicked",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user clicks to change their location after a city has been detected.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "city discontinued change city clicked",
      "component": "CityDiscontinuedComponent",
      "stage": "City Discontinued",
      "source": "Source.CITY_DISCONTINUED_SCREEN",
      "description": "Raised when user clicks to change city from the discontinued city screen.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_DISCONTINUED_SCREEN"
        }
      ]
    },
    {
      "name": "city discontinued screen displayed",
      "component": "CityDiscontinuedComponent",
      "stage": "City Discontinued",
      "source": "Source.CITY_DISCONTINUED_SCREEN",
      "description": "Raised when the city discontinued screen is displayed to the user.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_DISCONTINUED_SCREEN"
        },
        {
          "property": "cityName",
          "context": "Name of the discontinued city"
        }
      ]
    },
    {
      "name": "city fetch from location failed",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when fetching city from user's location fails.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        },
        {
          "property": "reason",
          "context": "Error type - CityIdNotAvailable, CityMetaDataFetchError, etc."
        }
      ]
    },
    {
      "name": "city location selection screen opened",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when the new city location selection screen is opened.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From navigation args"
        }
      ]
    },
    {
      "name": "city not serviceable screen",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when the detected city is not serviceable by Chalo.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "city selected",
      "component": "CitySelectionComponent / CityLocationSelectionComponent",
      "stage": "City Selection (Old Flow) / City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_FRAGMENT_SPACED / Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user selects a city. Used in both old and new city selection flows with different source values.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_FRAGMENT_SPACED (old) or Source.CITY_SELECTION_SCREEN (new)"
        },
        {
          "property": "previousScreen",
          "context": "From state (new flow only)"
        },
        {
          "property": "cityName",
          "context": "City display name (old flow only)"
        },
        {
          "property": "city",
          "context": "City id (new flow only)"
        },
        {
          "property": "selectedby",
          "context": "'user' (old flow) or omitted (new flow)"
        },
        {
          "property": "desc",
          "context": "City description (new flow only)"
        }
      ]
    },
    {
      "name": "city selection screen displayed",
      "component": "CitySelectionComponent",
      "stage": "City Selection (Old Flow)",
      "source": "Source.CITY_SELECTION_FRAGMENT",
      "description": "Raised when the old city selection screen is displayed.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_FRAGMENT"
        }
      ]
    },
    {
      "name": "city selection search icon clicked",
      "component": "CitySelectionComponent",
      "stage": "City Selection (Old Flow)",
      "source": "Source.CITY_SELECTION_FRAGMENT",
      "description": "Raised when user clicks the search icon in the old city selection screen.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_FRAGMENT"
        }
      ]
    },
    {
      "name": "enable device location clicked",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user clicks the enable device location button.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "enter location manually clicked",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user clicks to enter location manually instead of using device location.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "explore chalo cities clicked",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user clicks to explore all available Chalo cities.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "first screen open",
      "component": "SplashScreenComponent",
      "stage": "Splash Screen",
      "source": "(empty)",
      "description": "Raised once per session when the splash screen is displayed for the first time.",
      "properties": []
    },
    {
      "name": "access location event",
      "component": "LocationPermissionCallbackHandler",
      "stage": "City Location Selection (New Flow) / Location Disclaimer",
      "source": "Source.ONBOARDING_LOCATION_SHARING_SCREEN / Source.LOCATION_DISCLAIMER_ACTIVITY",
      "description": "Raised when the system location permission prompt is responded to (precise/approx/denied).",
      "properties": [
        {
          "property": "source",
          "context": "Source.ONBOARDING_LOCATION_SHARING_SCREEN.sourceName or Source.LOCATION_DISCLAIMER_ACTIVITY.sourceName"
        },
        {
          "property": "locationAccessAction",
          "context": "preciseLocationOptionSelected / approxLocationOptionSelected / locationPermissionDeniedByUser"
        }
      ]
    },
    {
      "name": "go to settings btn clicked",
      "component": "LocationDisclaimerComponent",
      "stage": "Location Disclaimer",
      "source": "Source.LOCATION_DISCLAIMER_ACTIVITY",
      "properties": [
        {
          "property": "is fine location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is coarse location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is gps enabled",
          "context": "From GPS state"
        },
        {
          "property": "previousScreen",
          "context": "From args.previousScreenSource"
        }
      ]
    },
    {
      "name": "language changed",
      "component": "LanguageSelectionComponent",
      "stage": "Language Selection",
      "source": "Source.LANGUAGE_SELECTION",
      "description": "Raised when user changes the language selection.",
      "properties": [
        {
          "property": "source",
          "context": "Source.LANGUAGE_SELECTION"
        },
        {
          "property": "language",
          "context": "Language locale code"
        }
      ]
    },
    {
      "name": "language screen continue clicked",
      "component": "LanguageSelectionComponent",
      "stage": "Language Selection",
      "source": "Source.LANGUAGE_SELECTION",
      "description": "Raised when user clicks continue after selecting a language.",
      "properties": [
        {
          "property": "source",
          "context": "Source.LANGUAGE_SELECTION"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        },
        {
          "property": "locale",
          "context": "Selected language locale code"
        }
      ]
    },
    {
      "name": "language selection screen displayed",
      "component": "LanguageSelectionComponent",
      "stage": "Language Selection",
      "source": "Source.LANGUAGE_SELECTION",
      "description": "Raised when the language selection screen is displayed to the user.",
      "properties": [
        {
          "property": "source",
          "context": "Source.LANGUAGE_SELECTION"
        },
        {
          "property": "previousScreen",
          "context": "From navigation args"
        }
      ]
    },
    {
      "name": "location denied event",
      "component": "LocationDisclaimerComponent",
      "stage": "Location Disclaimer",
      "source": "Source.LOCATION_DISCLAIMER_ACTIVITY",
      "properties": [
        {
          "property": "is fine location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is coarse location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is gps enabled",
          "context": "From GPS state"
        },
        {
          "property": "previousScreen",
          "context": "From args.previousScreenSource"
        },
        {
          "property": "result denied",
          "context": "SettingsResolutionException.statusCode"
        }
      ]
    },
    {
      "name": "location disclaimer activity opened",
      "component": "LocationDisclaimerComponent",
      "stage": "Location Disclaimer",
      "source": "Source.LOCATION_DISCLAIMER_ACTIVITY",
      "properties": [
        {
          "property": "is fine location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is coarse location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is gps enabled",
          "context": "From GPS state"
        },
        {
          "property": "previousScreen",
          "context": "From args.previousScreenSource"
        }
      ]
    },
    {
      "name": "location permission result event",
      "component": "LocationDisclaimerComponent",
      "stage": "Location Disclaimer",
      "source": "Source.LOCATION_DISCLAIMER_ACTIVITY",
      "properties": [
        {
          "property": "is fine location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is coarse location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is gps enabled",
          "context": "From GPS state"
        },
        {
          "property": "previousScreen",
          "context": "From args.previousScreenSource"
        }
      ]
    },
    {
      "name": "location successfully enabled",
      "component": "LocationDisclaimerComponent",
      "stage": "Location Disclaimer",
      "source": "Source.LOCATION_DISCLAIMER_ACTIVITY",
      "properties": [
        {
          "property": "is fine location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is coarse location enabled",
          "context": "From permissions status map"
        },
        {
          "property": "is gps enabled",
          "context": "From GPS state"
        },
        {
          "property": "previousScreen",
          "context": "From args.previousScreenSource"
        }
      ]
    },
    {
      "name": "new home screen rendered",
      "component": "SplashScreenComponent",
      "stage": "Splash Screen",
      "source": "(empty)",
      "description": "Raised when navigating from splash screen to the new home screen after initialization.",
      "properties": []
    },
    {
      "name": "permission_popup",
      "component": "CitySelectionComponent",
      "stage": "City Selection (Old Flow)",
      "source": "Source.CITY_SELECTION_FRAGMENT",
      "description": "Raised when location permission popup is triggered in the old city selection flow.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_FRAGMENT"
        },
        {
          "property": "element",
          "context": "'tutorial_location'"
        }
      ]
    },
    {
      "name": "retry city fetch clicked",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user clicks retry after city fetch fails.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "tab based homescreen rendered",
      "component": "SplashScreenComponent",
      "stage": "Splash Screen",
      "source": "(empty)",
      "description": "Raised when navigating from splash screen to the tab-based home screen.",
      "properties": []
    },
    {
      "name": "user refused location permission",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user refuses to grant location permission when requested.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "user refused location permission via settings",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user refuses to grant location permission via settings screen.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    },
    {
      "name": "user refused to turn gps on",
      "component": "CityLocationSelectionComponent",
      "stage": "City Location Selection (New Flow)",
      "source": "Source.CITY_SELECTION_SCREEN",
      "description": "Raised when user refuses to turn on GPS when prompted.",
      "properties": [
        {
          "property": "source",
          "context": "Source.CITY_SELECTION_SCREEN"
        },
        {
          "property": "previousScreen",
          "context": "From state"
        }
      ]
    }
  ],
  "diagram": {
    "type": "sequence",
    "notes": [
      "The onboarding flow has multiple entry points depending on user state: splash → language (if not set) → city selection (if not set) → home",
      "City selection has two implementations: old flow (CitySelectionComponent) and new flow (CityLocationSelectionComponent)",
      "User properties (deviceId, isNotifPermGranted, migrationRequired, firstSeen) are set during splash screen initialization but are not events"
    ],
    "steps": [
      {
        "label": "App Launch",
        "events": [
          "first screen open",
          "app open"
        ],
        "next": "language_check"
      },
      {
        "label": "Language Selection Check",
        "events": [],
        "next": "language_selection_or_login_check"
      },
      {
        "label": "Language Selection Flow",
        "events": [
          "language selection screen displayed",
          "language screen continue clicked",
          "language changed"
        ],
        "next": "login_check"
      },
      {
        "label": "Login Check",
        "events": [],
        "next": "city_status_or_selection"
      },
      {
        "label": "City Selection Flow (New)",
        "events": [
          "city location selection screen opened",
          "enable device location clicked",
          "access location event",
          "enter location manually clicked",
          "user refused location permission",
          "user refused location permission via settings",
          "user refused to turn gps on",
          "city fetch from location failed",
          "retry city fetch clicked",
          "change location clicked",
          "explore chalo cities clicked",
          "city not serviceable screen",
          "city selected"
        ],
        "next": "home_screen"
      },
      {
        "label": "City Selection Flow (Old)",
        "events": [
          "city selection screen displayed",
          "city selection search icon clicked",
          "permission_popup",
          "city selected"
        ],
        "next": "home_screen"
      },
      {
        "label": "City Discontinued Flow",
        "events": [
          "city discontinued screen displayed",
          "city discontinued change city clicked"
        ],
        "next": "city_selection"
      },
      {
        "label": "Home Screen",
        "events": [
          "new home screen rendered",
          "tab based homescreen rendered"
        ],
        "next": "end"
      },
      {
        "label": "Additional events: Location Disclaimer",
        "events": [
          "access location event"
        ]
      },
      {
        "label": "Additional events: Location Disclaimer",
        "events": [
          "go to settings btn clicked"
        ]
      },
      {
        "label": "Additional events: Location Disclaimer",
        "events": [
          "location denied event"
        ]
      },
      {
        "label": "Additional events: Location Disclaimer",
        "events": [
          "location disclaimer activity opened"
        ]
      },
      {
        "label": "Additional events: Location Disclaimer",
        "events": [
          "location permission result event"
        ]
      },
      {
        "label": "Additional events: Location Disclaimer",
        "events": [
          "location successfully enabled"
        ]
      }
    ]
  }
}
